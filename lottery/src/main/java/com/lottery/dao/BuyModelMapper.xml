<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lottery.dao.BuyModelMapper" >
  <resultMap id="BaseResultMap" type="com.lottery.pojo.BuyModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    <id column="BID" property="bid" jdbcType="DECIMAL" />
    <result column="BUYDATE" property="buydate" jdbcType="TIMESTAMP" />
    <result column="USERID" property="userid" jdbcType="DECIMAL" />
    <result column="LOTTERID" property="lotterid" jdbcType="DECIMAL" />
    <result column="BUYMONEY" property="buymoney" jdbcType="DECIMAL" />
    <result column="BUYNO" property="buyno" jdbcType="VARCHAR" />
    <result column="ISDRAW" property="isdraw" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    BID, BUYDATE, LOTTERID, BUYMONEY, BUYNO, USERID, ISDRAW
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Short" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from LOTTERY.T_BUY
    where BID = #{bid,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Short" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    delete from LOTTERY.T_BUY
    where BID = #{bid,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.lottery.pojo.BuyModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    insert into LOTTERY.T_BUY (BID, BUYDATE, LOTTERID, 
      BUYMONEY, BUYNO, USERID)
    values (seq_t_buy.nextval, #{buydate,jdbcType=TIMESTAMP}, #{lotterid,jdbcType=DECIMAL}, 
      #{buymoney,jdbcType=DECIMAL}, #{buyno,jdbcType=VARCHAR}, #{userid,jdbcType=DECIMAL},'未开奖')
  </insert>
  <insert id="insertSelective" parameterType="com.lottery.pojo.BuyModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    insert into LOTTERY.T_BUY
    <trim prefix="(" suffix=")" suffixOverrides="," >
        BID,
        BUYDATE,
        ISDRAW,
      <if test="lotterid != null" >
        LOTTERID,
      </if>
      <if test="buymoney != null" >
        BUYMONEY,
      </if>
      <if test="buyno != null" >
        BUYNO,
      </if>
      <if test="lotterid != null" >
        USERID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
        seq_t_buy.nextval,
        sysdate,
        '未开奖',
      <if test="lotterid != null" >
        #{lotterid,jdbcType=DECIMAL},
      </if>
      <if test="buymoney != null" >
        #{buymoney,jdbcType=DECIMAL},
      </if>
      <if test="buyno != null" >
        #{buyno,jdbcType=VARCHAR},
      </if>
      <if test="userid != null" >
        #{userid,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lottery.pojo.BuyModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    update LOTTERY.T_BUY
    <set >
      <if test="buydate != null" >
        BUYDATE = #{buydate,jdbcType=TIMESTAMP},
      </if>
      <if test="lotterid != null" >
        LOTTERID = #{lotterid,jdbcType=DECIMAL},
      </if>
      <if test="buymoney != null" >
        BUYMONEY = #{buymoney,jdbcType=DECIMAL},
      </if>
      <if test="buyno != null" >
        BUYNO = #{buyno,jdbcType=VARCHAR},
      </if>
      <if test="isdraw != null" >
        ISDRAW = #{isdraw,jdbcType=VARCHAR},
      </if>
      <if test="userid != null" >
        USERID = #{userid,jdbcType=DECIMAL},
      </if>
    </set>
    where BID = #{bid,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lottery.pojo.BuyModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
    update LOTTERY.T_BUY
    set BUYDATE = #{buydate,jdbcType=TIMESTAMP},
      LOTTERID = #{lotterid,jdbcType=DECIMAL},
      USERID = #{usererid,jdbcType=DECIMAL},
      BUYMONEY = #{buymoney,jdbcType=DECIMAL},
      ISDRAW = #{isdraw,jdbcType=VARCHAR},
      BUYNO = #{buyno,jdbcType=VARCHAR}
    where BID = #{bid,jdbcType=DECIMAL}
  </update>
  
  <resultMap type="com.lottery.vo.BuyVo" id="query_map">
  	<id column="bid" property="bid"/>
  	<result column="buydate" property="buydate"/>
  	<result column="buymoney" property="buymoney"/>
  	<result column="buyno" property="buyno"/>
  	<result column="lotypename" property="lotypename"/>
  	<result column="issue" property="issue"/>
  	<result column="lotterid" property="lotterid"/>
  	<result column="tlid" property="lid"/>
  	<result column="isdraw" property="isdraw"/>
  	<result column="buserid" property="userid"/>
  </resultMap>
  
  <select id="queryAll" resultMap="query_map" parameterType="com.lottery.vo.BuyVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Oct 28 11:11:04 CST 2017.
    -->
	select 
	t.lotypename,
	b.bid,
	b.buydate,
	b.buymoney,
	b.buyno,
	l.issue,
	b.isdraw,
	b.userid as buserid,
	t.lid as tlid,
	l.lotterid
		from t_buy b
		join t_lottery l
		on b.lotterid = l.lotterid
		join t_lotterytype t
		on t.lid = l.lid
    <where>
    	<if test="bid != 0" >
        and b.BID = #{bid,jdbcType=DECIMAL}
      </if>
      <if test="buydate != null" >
        and b.BUYDATE = #{buydate,jdbcType=TIMESTAMP}
      </if>
      <if test="lotterid != 0" >
        and b.LOTTERID = #{lotterid,jdbcType=DECIMAL}
      </if>
      <if test="userid != 0" >
        and b.USERID = #{userid,jdbcType=DECIMAL}
      </if>
      <if test="buymoney != null" >
        and b.BUYMONEY = #{buymoney,jdbcType=DECIMAL}
      </if>
      <if test="buyno != null" >
        and b.BUYNO = #{buyno,jdbcType=VARCHAR}
      </if>
      <if test="lid != 0" >
        and t.lid = #{lid}
      </if>
      <if test="isdraw != null and isdraw!=''" >
        and b.isdraw = #{isdraw}
      </if>
      <if test="issue != null and issue!=''">
        and l.issue = #{issue}
      </if>
    </where>
  </select>
  
  <resultMap type="com.lottery.pojo.BuyModel" id="buy_lottery_map">
  	<result column="lotterid" property="lotterid"/>
  	<result column="userid" property="userid"/>
  	<result column="buyno" property="buyno"/>
  </resultMap>
  
  <select id="selectByLottery" parameterType="map" resultMap="buy_lottery_map">
  	select
  	b.lotterid,
	b.userid,
	b.buyno
	from t_lottery l
	join t_buy b
	on l.lotterid = b.lotterid
	where l.issue = #{issue}
	and l.lid = #{lid}
  </select>
  
  <update id="updateIsDrawByBuyNo" parameterType="map">
  	update t_buy set isdraw = #{isdraw}
  	where buyno = #{buyno}
  </update>
  
  <select id="selectIsDraw" resultMap="BaseResultMap">
  	select isdraw
	from t_buy
	group by isdraw
  </select>
  
  <select id="selectSumMoney" resultType="DECIMAL" parameterType="short">
  	select sum(buymoney) from t_buy where userid = #{userid}
  </select>
</mapper>